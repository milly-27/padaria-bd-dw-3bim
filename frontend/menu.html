<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Menu Principal</title>
  <link rel="stylesheet" href="menu.css">
</head>

<body>
  <header>
    <div class="topo">
      <h3>Menu Principal</h3>
      <select id="oUsuario" onchange="handleUserAction(this.value)">
        <option value="">usuario</option>
        <option value="gerenciar-conta">Gerenciar Conta</option>
        <option value="sair">Sair</option>
      </select>
    </div>

    <nav class="nav">
      <ul class="nav__menu">
        <li class="nav__menu-item"><a href="#">Home</a></li>

        <li class="nav__menu-item">
          <a href="#">Cadastros</a>
          <ul class="nav__submenu">
            <li class="nav__submenu-item"><a href="http://localhost:3001/pessoas/abrirCrudPessoa">Pessoa</a></li>
            <li class="nav__submenu-item"><a href="#">Questão</a></li>
            <li class="nav__submenu-item"><a href="#">Avaliação</a></li>
          </ul>
        </li>

        <li class="nav__menu-item">
          <a href="#">About</a>
          <ul class="nav__submenu">
            <li class="nav__submenu-item"><a href="#">Our Company</a></li>
            <li class="nav__submenu-item"><a href="#">Our Team</a></li>
            <li class="nav__submenu-item"><a href="#">Our Reach</a></li>
          </ul>
        </li>

        <li class="nav__menu-item"><a href="#">Blog</a></li>
        <li class="nav__menu-item"><a href="#">Contact</a></li>

      </ul>
    </nav>
  </header>

  <main>

    <section>
      <p>section main....</p>
    </section>

  </main>

  <footer>
    <p>&copy; 2025 - Meu Site</p>
  </footer>

  <script src="./menu.js"></script>
  <script>
    const API_BASE_URL = 'http://localhost:3001';
    let ehProfessor = false;

    nomeUsuario();

    //essa função só existe para teste inicial
    function nomeUsuario() {
      const combobox = document.getElementById("oUsuario");
      const primeiraOpcao = combobox.options[0];
      primeiraOpcao.text = "Berola da Silva";
    }

    // Chame a função quando a página carregar
    window.onload = nomeUsuario;

    async function usuarioAutorizado() {
      const rota = API_BASE_URL + '/login/verificaSeUsuarioEstaLogado';
      const res = await fetch(rota, { credentials: 'include' });
      const data = await res.json();

      if (data.status === 'ok') {
        document.getElementById('boasVindas').innerText =
          `${data.nome} - ${data.mnemonicoProfessor ? `Professor: ${data.mnemonicoProfessor}` : ''}`;
        if (data.mnemonicoProfessor) ehProfessor = true;
      } else {
        alert("Você precisa fazer login.");
        window.location.href = "./login/login.html";
      }
    }

    async function logout() {
      await fetch('http://localhost:3005/logout', {
        method: 'POST',
        credentials: 'include'
      });
      window.location.href = "http://localhost:3005/inicio";
    }

    // usuarioAutorizado();
  </script>
</body>

</html>